/**
 * @file Main JS file for TextFormatterJS
 * @author Daniel Däschle
 */
var textSelected=!1,isTextFormatterVisible=!1,textFormatterTooltipElement='<div id="highlightTooltip"><button onclick="document.execCommand(\'bold\', false, null)"><i class="material-icons">format_bold</i></button><button onclick="document.execCommand(\'italic\', false, null)"><i class="material-icons">format_italic</i></button><button onclick="document.execCommand(\'underline\', false, null)"><i class="material-icons">format_underline</i></button><button onclick="changeSize(true)"><i class="material-icons">format_size</i><i class="material-icons">arrow_drop_up</i></button><button onclick="changeSize(false)"><i class="material-icons">format_size</i><i class="material-icons">arrow_drop_down</i></button></div>'
window.onload=function(){document.querySelector("body").innerHTML+=textFormatterTooltipElement},document.onselectionchange=function(e){var t=getSelectedText()
textSelected=""!==t},document.onclick=function(e){-1===document.getElementById("highlightTooltip").outerHTML.indexOf(e.target.outerHTML)&&isTextFormatterVisible&&(fadeOut(document.getElementById("highlightTooltip"),200),clearTimeout(delayedVisibleSetter),isTextFormatterVisible=!1)},document.onmouseup=document.onkeyup=function(){if(textSelected){var e=getSelectionCoords(),t=document.getElementById("highlightTooltip")
t.style.top=e.y-55+"px",t.style.left=e.x-50+"px",fadeIn(document.getElementById("highlightTooltip"),200),delayedVisibleSetter=setTimeout(function(){isTextFormatterVisible=!0},200)}}
var changeSize=function(e){var t=document.queryCommandValue("FontSize")||3
value=parseInt(t)+parseInt(e?1:-1),document.execCommand("fontSize",!1,value)},getSelectedText=function(){if(window.getSelection){var e=window.getSelection()
if(e.anchorNode&&!1!==e.anchorNode.parentNode.isContentEditable)return e.toString()}return""},getSelectionCoords=function(){var e,t,o,n=window.document,i=n.selection,l=0,a=0
if(i)"Control"!==i.type&&(e=i.createRange(),e.collapse(!0),l=e.boundingLeft,a=e.boundingTop)
else if(window.getSelection&&(i=window.getSelection(),i.rangeCount&&(e=i.getRangeAt(0).cloneRange(),e.getClientRects&&(e.collapse(!0),t=e.getClientRects(),t.length>0&&(o=t[0]),l=o.left,a=o.top),0===l&&0===a))){var c=n.createElement("span")
if(c.getClientRects){c.appendChild(n.createTextNode("​")),e.insertNode(c),o=c.getClientRects()[0],l=o.left,a=o.top
var r=c.parentNode
r.removeChild(c),r.normalize()}}return{x:l,y:a}},fadeIn=function(e,t,o){var n=e.style,i=25/(t||300)
n.opacity=n.opacity||0,n.display=o||"block",function e(){(n.opacity=parseFloat(n.opacity)+i)>1?n.opacity=1:setTimeout(e,25)}()},fadeOut=function(e,t){var o=e.style,n=25/(t||300)
o.opacity=o.opacity||1,function e(){(o.opacity-=n)<0?o.display="none":setTimeout(e,25)}()}
