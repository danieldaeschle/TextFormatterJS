/**
 * @file Main JS file for TextFormatterJS
 * @author Daniel Däschle
 */
var textSelected=!1,delayedVisibleSetter=null,isTextFormatterVisible=!1,fadingIn=!1,textFormatterTooltipElement='<div id="highlightTooltip"><button class="text-formatter-button" onclick="document.execCommand(\'bold\', false, null)"><i class="material-icons">format_bold</i></button><button class="text-formatter-button" onclick="document.execCommand(\'italic\', false, null)"><i class="material-icons">format_italic</i></button><button class="text-formatter-button" onclick="document.execCommand(\'underline\', false, null)"><i class="material-icons">format_underline</i></button><button class="text-formatter-button" onclick="changeSize(false)"><i style="padding: 3px" class="material-icons md-18">format_size</i></button><button class="text-formatter-button" onclick="changeSize(true)"><i class="material-icons">format_size</i></button></div>'
window.onload=function(){document.querySelector("body").innerHTML+=textFormatterTooltipElement},document.onselectionchange=function(e){var t=getSelectedText()
!(textSelected=""!==t)&&isTextFormatterVisible&&hideTooltip()},document.onmouseup=document.onkeyup=function(){if(textSelected){var e=getSelectionCoords(),t=document.getElementById("highlightTooltip")
e.y>60?t.style.top=e.y-55+"px":t.style.top=e.y+25+"px",e.x<55?t.style.left="5px":t.style.left=e.x-50+"px",fadeIn(document.getElementById("highlightTooltip"),200),delayedVisibleSetter=setTimeout(function(){isTextFormatterVisible=!0},50)}}
var hideTooltip=function(){delayedVisibleSetter&&clearTimeout(delayedVisibleSetter),fadeOut(document.getElementById("highlightTooltip"),200),isTextFormatterVisible=!1},changeSize=function(e){var t=document.queryCommandValue("FontSize")||3
value=parseInt(t)+parseInt(e?1:-1),document.execCommand("fontSize",!1,value)},getSelectedText=function(){if(window.getSelection){var e=window.getSelection()
if(e.anchorNode&&!1!==e.anchorNode.parentNode.isContentEditable)return e.toString()}return""},getSelectionCoords=function(){var e,t,o=document.selection,n=0,i=0
if(o)"Control"!==o.type&&(e=o.createRange(),e.collapse(!0),n=e.boundingLeft,i=e.boundingTop)
else if(window.getSelection&&(o=window.getSelection(),o.rangeCount&&(e=o.getRangeAt(0).cloneRange(),e.getClientRects&&(e.collapse(!0),e.getClientRects().length>0&&(t=e.getClientRects()[0],n=t.left,i=t.top)),0===n&&0===i))){var l=document.createElement("span")
if(l.getClientRects){l.appendChild(document.createTextNode("​")),e.insertNode(l),t=l.getClientRects()[0],n=t.left,i=t.top
var a=l.parentNode
a.removeChild(l),a.normalize()}}return{x:n,y:i}},fadeIn=function(e,t){var o=e.style,n=25/(t||300)
o.opacity=o.opacity||0,o.display="block",fadingIn=!0,function e(){(o.opacity=parseFloat(o.opacity)+n)>1?(o.opacity=1,fadingIn=!1):setTimeout(e,25)}()},fadeOut=function(e,t){var o=e.style,n=25/(t||300)
o.opacity=o.opacity||1,function e(){fadingIn||((o.opacity-=n)<0?o.display="none":setTimeout(e,25))}()}
