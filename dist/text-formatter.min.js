/**
 * @file Main JS file for TextFormatterJS
 * @author Daniel Däschle
 */
var textSelected=!1,isTextFormatterVisible=!1,textFormatterTooltipElement='<div id="highlightTooltip"><button class="text-formatter-button" onclick="document.execCommand(\'bold\', false, null)"><i class="material-icons">format_bold</i></button><button class="text-formatter-button" onclick="document.execCommand(\'italic\', false, null)"><i class="material-icons">format_italic</i></button><button class="text-formatter-button" onclick="document.execCommand(\'underline\', false, null)"><i class="material-icons">format_underline</i></button><button class="text-formatter-button" onclick="changeSize(true)"><i class="material-icons">format_size</i><i class="material-icons">arrow_drop_up</i></button><button class="text-formatter-button" onclick="changeSize(false)"><i class="material-icons">format_size</i><i class="material-icons">arrow_drop_down</i></button></div>'
window.onload=function(){document.querySelector("body").innerHTML+=textFormatterTooltipElement},document.onselectionchange=function(t){var e=getSelectedText()
textSelected=""!==e},document.onclick=document.onscroll=function(t){-1===document.getElementById("highlightTooltip").outerHTML.indexOf(t.target.outerHTML)&&isTextFormatterVisible&&""===getSelectedText()&&(fadeOut(document.getElementById("highlightTooltip"),200),clearTimeout(delayedVisibleSetter),isTextFormatterVisible=!1)},document.onmouseup=document.onkeyup=function(){if(textSelected){var t=getSelectionCoords(),e=document.getElementById("highlightTooltip")
t.y>60?e.style.top=t.y-55+"px":e.style.top=t.y+25+"px",t.x<55?e.style.left="5px":e.style.left=t.x-50+"px",fadeIn(document.getElementById("highlightTooltip"),200),delayedVisibleSetter=setTimeout(function(){isTextFormatterVisible=!0},200)}}
var changeSize=function(t){var e=document.queryCommandValue("FontSize")||3
value=parseInt(e)+parseInt(t?1:-1),document.execCommand("fontSize",!1,value)},getSelectedText=function(){if(window.getSelection){var t=window.getSelection()
if(t.anchorNode&&!1!==t.anchorNode.parentNode.isContentEditable)return t.toString()}return""},getSelectionCoords=function(){var t,e,o=document.selection,n=0,i=0
if(o)"Control"!==o.type&&(t=o.createRange(),t.collapse(!0),n=t.boundingLeft,i=t.boundingTop)
else if(window.getSelection&&(o=window.getSelection(),o.rangeCount&&(t=o.getRangeAt(0).cloneRange(),t.getClientRects&&(t.collapse(!0),t.getClientRects().length>0&&(e=t.getClientRects()[0],n=e.left,i=e.top)),0===n&&0===i))){var l=document.createElement("span")
if(l.getClientRects){l.appendChild(document.createTextNode("​")),t.insertNode(l),e=l.getClientRects()[0],n=e.left,i=e.top
var a=l.parentNode
a.removeChild(l),a.normalize()}}return{x:n,y:i}},fadeIn=function(t,e,o){var n=t.style,i=25/(e||300)
n.opacity=n.opacity||0,n.display=o||"block",function t(){(n.opacity=parseFloat(n.opacity)+i)>1?n.opacity=1:setTimeout(t,25)}()},fadeOut=function(t,e){var o=t.style,n=25/(e||300)
o.opacity=o.opacity||1,function t(){(o.opacity-=n)<0?o.display="none":setTimeout(t,25)}()}
